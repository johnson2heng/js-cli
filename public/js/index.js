/*! nan出品，必出精品 */!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){$(function(){$.ajax({url:"json/models.json",type:"GET",success:function(e){for(var t=$("#models-list .list"),n=0;n<e.length;n++){var o=e[n],a="\n            <li data-name='"+o.name+"' data-path='"+o.path+"' data-id='"+o.id+"'>\n                <div class=\"thumbnail\">\n                    <div class='img' style=\"background-image:url("+o.img+');" alt="..."></div>\n                    <div class="caption">\n                        <p>'+o.name+"</p>\n                    </div>\n                </div>\n            </li>";t.append(a)}},error:function(){}}),$("#models-type .tj").on("click",function(){var d={position:{x:e.val(),y:t.val(),z:n.val()},rotation:{x:o.val(),y:a.val(),z:i.val()},scale:{x:r.val(),y:l.val(),z:s.val()},ch:$("#models-type .ch").val(),cg:$("#models-type .cg").val(),tcmd:$("#models-type .tcmd").val(),sftjzc:$("#models-type .sftjzc").prop("checked"),cxk:$("#models-type .cxk").val(),xs:$("#models-type .xs").val()};$.ajax({url:"",type:"GET",data:d,success:function(){},error:function(){}}),console.log(d)});var e=$("#models-type .position-x"),t=$("#models-type .position-y"),n=$("#models-type .position-z"),o=$("#models-type .rotation-x"),a=$("#models-type .rotation-y"),i=$("#models-type .rotation-z"),r=$("#models-type .scale-x"),l=$("#models-type .scale-y"),s=$("#models-type .scale-z"),d=$("#control-wrap"),c=new function(e){var t=this;t.targetObject=null,this.initRenderer=function(){t.renderer=new THREE.WebGLRenderer({antialias:!0,logarithmicDepthBuffer:!0});var n=t.renderer;n.setClearColor("#999999"),n.setSize(e.width(),e.height()),e[0].appendChild(n.domElement)},this.initScene=function(){t.scene=new THREE.Scene,t.controlScene=new THREE.Scene,t.group=new THREE.Group,t.scene.add(t.group)},this.initCamera=function(){t.camera=new THREE.PerspectiveCamera(45,e.width()/e.height(),.1,2e4);var n=t.camera;n.position.set(5,5,5),t.scene.add(n)},this.initControl=function(){t.control=new THREE.OrbitControls(t.camera,t.renderer.domElement),t.modelControl=new THREE.TransformControls(t.camera,t.renderer.domElement),t.modelControl.setSpace("world"),t.scene.add(t.modelControl),t.modelControl.addEventListener("dragging-changed",function(e){t.control.enabled=!e.value,t.modelControl.object&&t.updateModelCallback(t.targetObject)})},this.setControlMode=function(e){t.modelControl.setMode(e)},this.initLight=function(){t.scene.add(new THREE.AmbientLight(6710886));var e=new THREE.PointLight(10066329);t.camera.add(e)},this.animate=function(){!function e(){t.draw();requestAnimationFrame(e)}()},this.draw=function(){t.renderer.render(t.scene,t.camera)},this.initGrid=function(){var e=new THREE.GridHelper(500,200,16777215,3355443);t.scene.add(e);var n=new THREE.Mesh(new THREE.PlaneBufferGeometry(5e3,5e3));n.rotation.x=-Math.PI/2,n.visible=!1,t.plane=n,t.scene.add(n)},this.init=function(){t.initRenderer(),t.initScene(),t.initCamera(),t.initControl(),t.initOutLine(),t.initLight(),t.animate(),t.initGrid(),t.addTouch()},this.addModel=function(e,n,o,a,i){var r=t.twoToThree(e,n);if(r){var l=new THREE.STLLoader;l.load("models/"+a,function(e){let n=new THREE.MeshLambertMaterial,l=new THREE.Mesh(e,n);l.name=o,l.userData.id=o,l.userData.path=a,l.userData.name=i,l.position.copy(r),t.group.add(l),t.changeHot(l)})}},this.addTouch=function(){var e=new THREE.Raycaster,n=new THREE.Vector2,o=t.renderer;$(o.domElement).on("click",function(a){n.x=a.clientX/o.domElement.offsetWidth*2-1,n.y=-a.clientY/o.domElement.offsetHeight*2+1,e.setFromCamera(n,t.camera);var i=e.intersectObjects(t.group.children,!0);if(i.length>0){var r=function e(n){for(var o=0;o<t.group.children.length;o++)if(t.group.children[o]===n)return n;return e(n.parent)}(i[0].object);t.changeHot(r)}})},this.twoToThree=function(e,n){var o=new THREE.Raycaster,a=new THREE.Vector2,i=t.renderer.domElement.clientWidth,r=t.renderer.domElement.clientHeight;a.x=e/i*2-1,a.y=-n/r*2+1,o.setFromCamera(a,t.camera),t.plane.visible=!0;var l=o.intersectObject(t.plane);return t.plane.visible=!1,l.length>0&&l[0].point},this.initOutLine=function(){var n,o,a;n=new THREE.EffectComposer(t.renderer);var i=new THREE.RenderPass(t.scene,t.camera);n.addPass(i),t.composer=n,a=new THREE.OutlinePass(new THREE.Vector2(e.width(),e.height()),t.scene,t.camera),n.addPass(a),t.outlinePass=a,a.edgeStrength=10,a.visibleEdgeColor.set("#0000ff"),a.hiddenEdgeColor.set("#0000ff"),(o=new THREE.ShaderPass(THREE.FXAAShader)).uniforms.resolution.value.set(1/e.width(),1/e.height()),o.renderToScreen=!0,n.addPass(o)},this.changeHot=function(e){t.targetObject=e,t.outlinePass.selectedObjects=[e],t.modelControl.attach(e),t.changeHotCallback(e)},this.updateModel=function(e){t.targetObject&&(t.targetObject.position.set(+e.position.x,+e.position.y,+e.position.z),t.targetObject.rotation.set(+e.rotation.x,+e.rotation.y,+e.rotation.z),t.targetObject.scale.set(+e.scale.x,+e.scale.y,+e.scale.z))},this.changeHotCallback=function(){},this.updateModelCallback=function(){}}($("#canvas-wrap"));c.init(),d.find(".btn").on("click",function(){p($(this))}),$("#models-type input").on("input",function(){!function(){var d={position:{x:e.val(),y:t.val(),z:n.val()},rotation:{x:o.val(),y:a.val(),z:i.val()},scale:{x:r.val(),y:l.val(),z:s.val()}};c.updateModel(d)}()}),c.changeHotCallback=function(e){d.show(),p(d.find(".btn").eq(0)),m(e)},c.updateModelCallback=m;var u=document.createElement("div");function m(d){var c=d.userData;$("#models-type .name").val(c.name),$("#models-type .id").val(c.id),e.val(d.position.x.toFixed(2)),t.val(d.position.y.toFixed(2)),n.val(d.position.z.toFixed(2)),o.val(d.rotation.x.toFixed(2)),a.val(d.rotation.y.toFixed(2)),i.val(d.rotation.z.toFixed(2)),r.val(d.scale.x.toFixed(2)),l.val(d.scale.y.toFixed(2)),s.val(d.scale.z.toFixed(2))}function p(e){e.addClass("btn-success").removeClass("btn-default").siblings().addClass("btn-default").removeClass("btn-success");var t=e.data("name");c.setControlMode(t)}u.className="move-div",document.body.appendChild(u),$("#models-list .list").on("mousedown","li",function(e){e.preventDefault();var t=$(this).data("id"),n=$(this).data("name"),o=$(this).data("path");function a(e){u.style.display="block",u.style.left=e.clientX+"px",u.style.top=e.clientY+"px"}u.style.backgroundImage=$(this).find(".img").css("background-image"),$(document).on("mouseup",function e(i){if(i.target===c.renderer.domElement){var r=i.clientX,l=i.clientY;c.addModel(r,l,t,o,n)}u.style.display="none",$(document).off("mouseup",e),$(document).off("mousemove",a)}),$(document).on("mousemove",a)})})}]);